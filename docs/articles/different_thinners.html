<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="David Gerard" />


<title>Applying Different Thinning Functions</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Applying Different Thinning Functions</h1>
<h4 class="author">David Gerard</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(seqgendiff)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(limma)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">set.seed</span>(<span class="dv">31</span>) <span class="co">## for reproducibility</span></a></code></pre></div>
<div id="abstract" class="section level1">
<h1>Abstract</h1>
<p>We demonstrate how to apply the different thinning functions available in seqgendiff. The following contains guidelines for the workflow of a single repetition in a simulation study.</p>
<p>The methods used here are described in Gerard (2020).</p>
</div>
<div id="generate-data" class="section level1">
<h1>Generate Data</h1>
<p>We will use simulated data for this vignette. Though in practice you would obtain the RNA-seq counts from a real dataset.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">nsamp &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb2-2" title="2">ngene &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb2-3" title="3">mat   &lt;-<span class="st"> </span><span class="kw">matrix</span>(stats<span class="op">::</span><span class="kw">rpois</span>(<span class="dt">n =</span> nsamp <span class="op">*</span><span class="st"> </span>ngene, <span class="dt">lambda =</span> <span class="dv">100</span>), </a>
<a class="sourceLine" id="cb2-4" title="4">                <span class="dt">nrow =</span> ngene,</a>
<a class="sourceLine" id="cb2-5" title="5">                <span class="dt">ncol =</span> nsamp)</a></code></pre></div>
</div>
<div id="subsetting" class="section level1">
<h1>Subsetting</h1>
<p>Each repetition of a simulation study, you should randomly subset your RNA-seq data so that your results are not dependent on the quirks of a few individuals/genes. The function to do this is <code>select_counts()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">submat &lt;-<span class="st"> </span><span class="kw">select_counts</span>(<span class="dt">mat =</span> mat, <span class="dt">nsamp =</span> <span class="dv">6</span>, <span class="dt">ngene =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>The default is to randomly select the samples and genes. Though there are many options available on how to select the genes using the <code>gselect</code> argument.</p>
<p>If the row and column names of the original matrix are <code>NULL</code>, then the row and column names of the returned submatrix contain the indices of the selected rows and columns of the original matrix.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">head</span>(<span class="kw">rownames</span>(submat))</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt; [1] &quot;23&quot;  &quot;25&quot;  &quot;38&quot;  &quot;39&quot;  &quot;68&quot;  &quot;107&quot;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">head</span>(<span class="kw">colnames</span>(submat))</a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt; [1] &quot;18&quot; &quot;44&quot; &quot;62&quot; &quot;69&quot; &quot;92&quot; &quot;99&quot;</span></a></code></pre></div>
</div>
<div id="thinning-library-size" class="section level1">
<h1>Thinning Library Size</h1>
<p>If you are exploring the effects of heterogeneous library sizes, use <code>thin_lib()</code>. You specify the thinning factor on the log-2 scale, so a value of 0 means no thinning, a value of 1 means thin by half, a value of 2 means thin by 1/4, etc. You need to specify this scaling factor for all samples.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">scaling_factor &lt;-<span class="st"> </span><span class="kw">seq_len</span>(<span class="kw">ncol</span>(submat))</a>
<a class="sourceLine" id="cb5-2" title="2">scaling_factor</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; [1] 1 2 3 4 5 6</span></a>
<a class="sourceLine" id="cb5-4" title="4">thout &lt;-<span class="st"> </span><span class="kw">thin_lib</span>(<span class="dt">mat =</span> submat, <span class="dt">thinlog2 =</span> scaling_factor)</a></code></pre></div>
<p>We can verify that thinning was performed correctly by looking at the empirical thinning amount.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">## Empirical thinning</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">colSums</span>(thout<span class="op">$</span>mat) <span class="op">/</span><span class="st"> </span><span class="kw">colSums</span>(submat)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt;      18      44      62      69      92      99 </span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; 0.49888 0.24906 0.12624 0.06289 0.03109 0.01599</span></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">## Specified thinning</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="dv">2</span> <span class="op">^</span><span class="st"> </span><span class="op">-</span>scaling_factor</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; [1] 0.50000 0.25000 0.12500 0.06250 0.03125 0.01562</span></a></code></pre></div>
<p>A similar function exists to thin gene-wise rather than sample-wise: <code>thin_gene()</code>.</p>
</div>
<div id="total-thinning" class="section level1">
<h1>Total Thinning</h1>
<p>To uniformly thin all counts, use <code>thin_all()</code>. This might be useful for determining read-depth suggestions. It takes as input a single universal scaling factor on the log-2 scale.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">thout &lt;-<span class="st"> </span><span class="kw">thin_all</span>(<span class="dt">mat =</span> submat, <span class="dt">thinlog2 =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>We can verify that we approximately halved all counts:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">sum</span>(thout<span class="op">$</span>mat) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(submat)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&gt; [1] 0.4998</span></a></code></pre></div>
</div>
<div id="general-thinning" class="section level1">
<h1>General Thinning</h1>
<p>Use <code>thin_diff()</code> for general thinning. For this function, you need to specify both the coefficient matrix and the design matrix.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">designmat &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">each =</span> <span class="kw">ncol</span>(submat) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>), </a>
<a class="sourceLine" id="cb9-2" title="2">                   <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">length.out =</span> <span class="kw">ncol</span>(submat)))</a>
<a class="sourceLine" id="cb9-3" title="3">designmat</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&gt;      [,1] [,2]</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt; [1,]    0    0</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt; [2,]    0    1</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt; [3,]    0    0</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt; [4,]    1    1</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt; [5,]    1    0</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt; [6,]    1    1</span></a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12">coefmat &lt;-<span class="st"> </span><span class="kw">matrix</span>(stats<span class="op">::</span><span class="kw">rnorm</span>(<span class="kw">ncol</span>(designmat) <span class="op">*</span><span class="st"> </span><span class="kw">nrow</span>(submat)),</a>
<a class="sourceLine" id="cb9-13" title="13">                  <span class="dt">ncol =</span> <span class="kw">ncol</span>(designmat),</a>
<a class="sourceLine" id="cb9-14" title="14">                  <span class="dt">nrow =</span> <span class="kw">nrow</span>(submat))</a>
<a class="sourceLine" id="cb9-15" title="15"><span class="kw">head</span>(coefmat)</a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt;         [,1]    [,2]</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; [1,]  0.2554 -1.3119</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; [2,]  0.6378  0.5336</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt; [3,]  1.3053  0.6764</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt; [4,]  0.1384 -0.9041</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt; [5,] -0.1251  1.3601</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">#&gt; [6,] -0.8867 -0.5249</span></a></code></pre></div>
<p>Once we have the coefficient and design matrices, we can thin.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">thout &lt;-<span class="st"> </span><span class="kw">thin_diff</span>(<span class="dt">mat          =</span> submat, </a>
<a class="sourceLine" id="cb10-2" title="2">                   <span class="dt">design_fixed =</span> designmat, </a>
<a class="sourceLine" id="cb10-3" title="3">                   <span class="dt">coef_fixed   =</span> coefmat)</a></code></pre></div>
<p>We can verify that we thinned correctly using the voom-limma pipeline.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">new_design &lt;-<span class="st"> </span><span class="kw">cbind</span>(thout<span class="op">$</span>design_obs, thout<span class="op">$</span>designmat)</a>
<a class="sourceLine" id="cb11-2" title="2">vout &lt;-<span class="st"> </span>limma<span class="op">::</span><span class="kw">voom</span>(<span class="dt">counts =</span> thout<span class="op">$</span>mat, <span class="dt">design =</span> new_design)</a>
<a class="sourceLine" id="cb11-3" title="3">lout &lt;-<span class="st"> </span>limma<span class="op">::</span><span class="kw">lmFit</span>(vout)</a>
<a class="sourceLine" id="cb11-4" title="4">coefhat &lt;-<span class="st"> </span><span class="kw">coef</span>(lout)[, <span class="dv">-1</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</a></code></pre></div>
<p>We’ll plot the true coefficients against their estimates.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">oldpar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="fl">2.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb12-2" title="2">              <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">0.5</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">plot</span>(<span class="dt">x    =</span> coefmat[, <span class="dv">1</span>], </a>
<a class="sourceLine" id="cb12-4" title="4">     <span class="dt">y    =</span> coefhat[, <span class="dv">1</span>], </a>
<a class="sourceLine" id="cb12-5" title="5">     <span class="dt">xlab =</span> <span class="st">&quot;True Coefficient&quot;</span>, </a>
<a class="sourceLine" id="cb12-6" title="6">     <span class="dt">ylab =</span> <span class="st">&quot;Estimated Coefficient&quot;</span>,</a>
<a class="sourceLine" id="cb12-7" title="7">     <span class="dt">main =</span> <span class="st">&quot;First Variable&quot;</span>,</a>
<a class="sourceLine" id="cb12-8" title="8">     <span class="dt">pch  =</span> <span class="dv">16</span>)</a>
<a class="sourceLine" id="cb12-9" title="9"><span class="kw">abline</span>(<span class="dt">a   =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb12-10" title="10">       <span class="dt">b   =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb12-11" title="11">       <span class="dt">lty =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb12-12" title="12">       <span class="dt">col =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb12-13" title="13">       <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">plot</span>(<span class="dt">x    =</span> coefmat[, <span class="dv">2</span>], </a>
<a class="sourceLine" id="cb13-3" title="3">     <span class="dt">y    =</span> coefhat[, <span class="dv">2</span>], </a>
<a class="sourceLine" id="cb13-4" title="4">     <span class="dt">xlab =</span> <span class="st">&quot;True Coefficient&quot;</span>, </a>
<a class="sourceLine" id="cb13-5" title="5">     <span class="dt">ylab =</span> <span class="st">&quot;Estimated Coefficient&quot;</span>,</a>
<a class="sourceLine" id="cb13-6" title="6">     <span class="dt">main =</span> <span class="st">&quot;Second Variable&quot;</span>,</a>
<a class="sourceLine" id="cb13-7" title="7">     <span class="dt">pch  =</span> <span class="dv">16</span>)</a>
<a class="sourceLine" id="cb13-8" title="8"><span class="kw">abline</span>(<span class="dt">a   =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb13-9" title="9">       <span class="dt">b   =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb13-10" title="10">       <span class="dt">lty =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb13-11" title="11">       <span class="dt">col =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb13-12" title="12">       <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">par</span>(oldpar)</a></code></pre></div>
</div>
<div id="correlation-with-surrogate-variables" class="section level1">
<h1>Correlation with Surrogate Variables</h1>
<p>The difference between the <code>design_fixed</code> and <code>design_perm</code> arguments is that the rows in <code>design_perm</code> are permuted before applying thinning. Without any other arguments, this makes the design variables independent of any surrogate variables. With the additional specification of the <code>target_cor</code> argument, we try to control the amount of correlation between the design variables in <code>design_perm</code> and any surrogate variables.</p>
<p>Let’s target for a correlation of 0.9 between the first surrogate variable and the first design variable, and a correlation of 0 between the first surrogate variable and the second design variable.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">target_cor &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.9</span>, <span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb15-2" title="2">target_cor</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">#&gt; [1,]  0.9</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co">#&gt; [2,]  0.0</span></a>
<a class="sourceLine" id="cb15-6" title="6">thout_cor &lt;-<span class="st"> </span><span class="kw">thin_diff</span>(<span class="dt">mat         =</span> submat,</a>
<a class="sourceLine" id="cb15-7" title="7">                       <span class="dt">design_perm =</span> designmat, </a>
<a class="sourceLine" id="cb15-8" title="8">                       <span class="dt">coef_perm   =</span> coefmat, </a>
<a class="sourceLine" id="cb15-9" title="9">                       <span class="dt">target_cor  =</span> target_cor)</a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co">#&gt; Note that optmatch uses a strange non-standard license:</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">#&gt; https://cran.r-project.org/package=optmatch/LICENSE</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="co">#&gt; If this doesn&#39;t work for you, try permute_method = &quot;hungarian&quot;</span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="co">#&gt; This message is displayed once per R session.</span></a></code></pre></div>
<p>The first variable is indeed more strongly correlated with the estimated surrogate variable:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">cor</span>(thout_cor<span class="op">$</span>designmat, thout_cor<span class="op">$</span>sv)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="co">#&gt;      [,1]</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co">#&gt; P1 0.7473</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">#&gt; P2 0.2976</span></a></code></pre></div>
</div>
<div id="estimate-actual-correlation" class="section level1">
<h1>Estimate Actual Correlation</h1>
<p>The actual correlation between the permuted design matrix and the surrogate variables will not be the target correlation. But we can estimate what the actual correlation is using the function <code>effective_cor()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">eout &lt;-<span class="st"> </span><span class="kw">effective_cor</span>(<span class="dt">design_perm =</span> designmat, </a>
<a class="sourceLine" id="cb17-2" title="2">                      <span class="dt">sv          =</span> thout_cor<span class="op">$</span>sv, </a>
<a class="sourceLine" id="cb17-3" title="3">                      <span class="dt">target_cor  =</span> target_cor, </a>
<a class="sourceLine" id="cb17-4" title="4">                      <span class="dt">iternum     =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb17-5" title="5">eout</a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co">#&gt;        [,1]</span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">#&gt; [1,] 0.7113</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">#&gt; [2,] 0.1399</span></a></code></pre></div>
<p>I am only using 50 iterations here for speed reasons, but you should stick to the defaults for <code>iternum</code>.</p>
</div>
<div id="special-case-of-two-group-model" class="section level1">
<h1>Special Case of Two-group Model</h1>
<p>For the special case when your design matrix is just a group indicator (that is, you have two groups of individuals), you can use the function <code>thin_2group()</code>. Let’s generate data from the two-group model where 90% of genes are null and the non-null effects are gamma-distributed.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">thout &lt;-<span class="st"> </span><span class="kw">thin_2group</span>(<span class="dt">mat           =</span> submat, </a>
<a class="sourceLine" id="cb18-2" title="2">                     <span class="dt">prop_null     =</span> <span class="fl">0.9</span>, </a>
<a class="sourceLine" id="cb18-3" title="3">                     <span class="dt">signal_fun    =</span> stats<span class="op">::</span>rgamma,</a>
<a class="sourceLine" id="cb18-4" title="4">                     <span class="dt">signal_params =</span> <span class="kw">list</span>(<span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">rate =</span> <span class="dv">1</span>))</a></code></pre></div>
<p>We can again verify that we thinned appropriately using the voom-limma pipeline:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">new_design &lt;-<span class="st"> </span><span class="kw">cbind</span>(thout<span class="op">$</span>design_obs, thout<span class="op">$</span>designmat)</a>
<a class="sourceLine" id="cb19-2" title="2">new_design</a>
<a class="sourceLine" id="cb19-3" title="3"><span class="co">#&gt;      (Intercept) P1</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co">#&gt; [1,]           1  0</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="co">#&gt; [2,]           1  0</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="co">#&gt; [3,]           1  0</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="co">#&gt; [4,]           1  1</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="co">#&gt; [5,]           1  1</span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="co">#&gt; [6,]           1  1</span></a>
<a class="sourceLine" id="cb19-10" title="10">vout &lt;-<span class="st"> </span>limma<span class="op">::</span><span class="kw">voom</span>(<span class="dt">counts =</span> thout<span class="op">$</span>mat, <span class="dt">design =</span> new_design)</a>
<a class="sourceLine" id="cb19-11" title="11">lout &lt;-<span class="st"> </span>limma<span class="op">::</span><span class="kw">lmFit</span>(vout)</a>
<a class="sourceLine" id="cb19-12" title="12">coefhat &lt;-<span class="st"> </span><span class="kw">coef</span>(lout)[, <span class="dv">2</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</a></code></pre></div>
<p>And we can plot the results</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">oldpar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="fl">2.5</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb20-2" title="2">              <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">0.5</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb20-3" title="3"><span class="kw">plot</span>(<span class="dt">x    =</span> thout<span class="op">$</span>coefmat, </a>
<a class="sourceLine" id="cb20-4" title="4">     <span class="dt">y    =</span> coefhat, </a>
<a class="sourceLine" id="cb20-5" title="5">     <span class="dt">xlab =</span> <span class="st">&quot;True Coefficient&quot;</span>, </a>
<a class="sourceLine" id="cb20-6" title="6">     <span class="dt">ylab =</span> <span class="st">&quot;Estimated Coefficient&quot;</span>,</a>
<a class="sourceLine" id="cb20-7" title="7">     <span class="dt">main =</span> <span class="st">&quot;First Variable&quot;</span>,</a>
<a class="sourceLine" id="cb20-8" title="8">     <span class="dt">pch  =</span> <span class="dv">16</span>)</a>
<a class="sourceLine" id="cb20-9" title="9"><span class="kw">abline</span>(<span class="dt">a   =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb20-10" title="10">       <span class="dt">b   =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb20-11" title="11">       <span class="dt">lty =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb20-12" title="12">       <span class="dt">col =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb20-13" title="13">       <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<ul>
<li>Gerard, D (2020). “Data-based RNA-seq simulations by binomial thinning.” <em>BMC Bioinformatics</em>. 21(1), 206. doi: <a href="https://doi.org/10.1186/s12859-020-3450-9">10.1186/s12859-020-3450-9</a>.</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
