<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulate RNA-seq Data from Real Data • seqgendiff</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulate RNA-seq Data from Real Data">
<meta property="og:description" content="seqgendiff">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">seqgendiff</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/different_thinners.html">Applying Different Thinning Functions</a>
    </li>
    <li>
      <a href="../articles/simulate_rnaseq.html">Simulate RNA-seq Data from Real Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dcgerard/seqgendiff/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulate RNA-seq Data from Real Data</h1>
                        <h4 data-toc-skip class="author">David
Gerard</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dcgerard/seqgendiff/blob/HEAD/vignettes/simulate_rnaseq.Rmd" class="external-link"><code>vignettes/simulate_rnaseq.Rmd</code></a></small>
      <div class="hidden name"><code>simulate_rnaseq.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<p>We demonstrate how one may use seqgendiff in differential expression
simulation studies using the airway data from Himes et al (2014). We use
seqgendiff to simulate one dataset which we then analyze with two
pipelines: the sva-voom-limma-eBayes-qvalue pipeline, and the
sva-DESeq2-qvalue pipeline. In practice, you would simulate many
datasets and compare average performance. But playing with a single
dataset can help you gain intuition with various methods.</p>
<p>The methods used here are described in Gerard (2020).</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>Set the seed for reproducibility:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The airway data are available in the airway R package from
Bioconductor. If you don’t have this package, you can install it with
the BiocManager package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"airway"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can load these data into R.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">airway</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"airway"</span><span class="op">)</span></span></code></pre></div>
<p>You can read about these data <a href="https://bioconductor.org/packages/airway/" class="external-link">here</a>.</p>
<p>These are the other packages that we’ll need for this vignette:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dcgerard/seqgendiff" class="external-link">seqgendiff</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thelovelab/DESeq2" class="external-link">DESeq2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioinf.wehi.edu.au/limma/" class="external-link">limma</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sva</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/jdstorey/qvalue" class="external-link">qvalue</a></span><span class="op">)</span></span></code></pre></div>
<p>The last five packages are all from Bioconductor, which you need to
install using <code><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">BiocManager::install()</a></code>.</p>
<p>The airway dataset comes with a few observed variables which affect
gene expression. We’ll consider these “surrogate variables”. That is,
we’ll add signal to the data and try to account for these surrogate
variables.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coldat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">airway</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cell"</span>, <span class="st">"dex"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">true_sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">cell</span> <span class="op">+</span> <span class="va">dex</span>, data <span class="op">=</span> <span class="va">coldat</span><span class="op">)</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">true_sv</span></span>
<span><span class="co">#&gt;            cellN061011 cellN080611 cellN61311 dexuntrt</span></span>
<span><span class="co">#&gt; SRR1039508           0           0          1        1</span></span>
<span><span class="co">#&gt; SRR1039509           0           0          1        0</span></span>
<span><span class="co">#&gt; SRR1039512           0           0          0        1</span></span>
<span><span class="co">#&gt; SRR1039513           0           0          0        0</span></span>
<span><span class="co">#&gt; SRR1039516           0           1          0        1</span></span>
<span><span class="co">#&gt; SRR1039517           0           1          0        0</span></span>
<span><span class="co">#&gt; SRR1039520           1           0          0        1</span></span>
<span><span class="co">#&gt; SRR1039521           1           0          0        0</span></span></code></pre></div>
<p>Suppose we want to add a treatment effect to the RNA-seq data. We’ll
first remove all genes with no counts:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allzero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MatrixGenerics/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">airway</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">6</span></span>
<span><span class="va">airway</span> <span class="op">&lt;-</span> <span class="va">airway</span><span class="op">[</span><span class="op">!</span><span class="va">allzero</span>, <span class="op">]</span></span></code></pre></div>
<p>Then we’ll use the convenient <code><a href="../reference/thin_2group.html">thin_2group()</a></code> function
from the seqgendiff package to add a <span class="math inline">\(N(0,
0.8^2)\)</span> log2-effect size to 10% of the genes:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thout</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thin_2group.html">thin_2group</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">airway</span><span class="op">)</span>, </span>
<span>                     prop_null <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>                     signal_fun <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span>,</span>
<span>                     signal_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s see how well the sva-voom-limma-ebayes-qvalue pipeline does
estimating these effects. First, we’ll fit this pipeline.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">design_obs</span>, <span class="va">thout</span><span class="op">$</span><span class="va">designmat</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">mat</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">n_sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sva/man/num.sv.html" class="external-link">num.sv</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Y</span>, mod <span class="op">=</span> <span class="va">X</span><span class="op">)</span></span>
<span><span class="va">svout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sva/man/sva.html" class="external-link">sva</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">Y</span>, mod <span class="op">=</span> <span class="va">X</span>, n.sv <span class="op">=</span> <span class="va">n_sv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of significant surrogate variables is:  2 </span></span>
<span><span class="co">#&gt; Iteration (out of 5 ):1  2  3  4  5</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">voom</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">thout</span><span class="op">$</span><span class="va">mat</span>, design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">svout</span><span class="op">$</span><span class="va">sv</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">lmFit</a></span><span class="op">(</span><span class="va">vout</span><span class="op">)</span></span>
<span><span class="va">eout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">eBayes</a></span><span class="op">(</span><span class="va">lout</span><span class="op">)</span></span>
<span><span class="va">qout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qvalue/man/qvalue.html" class="external-link">qvalue</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">eout</span><span class="op">$</span><span class="va">p.value</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bhat</span> <span class="op">&lt;-</span> <span class="va">eout</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>We plot the coefficient estimates against their true values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">coefmat</span>, </span>
<span>     <span class="va">bhat</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"True Coefficients"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"Estimated Coefficients"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate_rnaseq_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We plot the q-values against the null status of each gene.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_null_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">coefmat</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">qout</span><span class="op">$</span><span class="va">qvalues</span> <span class="op">~</span> <span class="va">is_null_gene</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Null Gene"</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"q-value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate_rnaseq_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Does the sva-DESeq2 pipeline do any better? We’ll first use
<code><a href="../reference/ThinDataToDESeqDataSet.html">seqgendiff::ThinDataToDESeqDataSet()</a></code> to convert the
<code>ThinData</code> object <code>thout</code> into a
<code>DESeqDataSet</code> object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thout</span><span class="op">$</span><span class="va">design_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">design_obs</span>, <span class="va">svout</span><span class="op">$</span><span class="va">sv</span><span class="op">)</span></span>
<span><span class="va">dds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ThinDataToDESeqDataSet.html">ThinDataToDESeqDataSet</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">thout</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">dds</span><span class="op">)</span></span>
<span><span class="co">#&gt; DataFrame with 8 rows and 3 columns</span></span>
<span><span class="co">#&gt;                 V1         V2        P1</span></span>
<span><span class="co">#&gt;          &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">#&gt; sample1  0.0485018 -0.4083842         1</span></span>
<span><span class="co">#&gt; sample2 -0.2708839  0.0966583         0</span></span>
<span><span class="co">#&gt; sample3  0.2242398 -0.3339757         0</span></span>
<span><span class="co">#&gt; sample4 -0.5996041  0.1820477         1</span></span>
<span><span class="co">#&gt; sample5  0.4572722 -0.0470452         0</span></span>
<span><span class="co">#&gt; sample6  0.4676154  0.6664671         1</span></span>
<span><span class="co">#&gt; sample7 -0.0347525 -0.4100548         0</span></span>
<span><span class="co">#&gt; sample8 -0.2923887  0.2542868         1</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">design</span><span class="op">(</span><span class="va">dds</span><span class="op">)</span></span>
<span><span class="co">#&gt; ~V1 + V2 + P1</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55fd198d0130&gt;</span></span></code></pre></div>
<p>Note that we added the estimated surrogate variables from sva to the
<code>ThinData</code> object before converting to a
<code>DESeqDataSet</code> object.</p>
<p>Now we will fit DESeq2.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeq.html" class="external-link">DESeq</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">dds</span><span class="op">)</span></span>
<span><span class="co">#&gt; estimating size factors</span></span>
<span><span class="co">#&gt; estimating dispersions</span></span>
<span><span class="co">#&gt; gene-wise dispersion estimates</span></span>
<span><span class="co">#&gt; mean-dispersion relationship</span></span>
<span><span class="co">#&gt; final dispersion estimates</span></span>
<span><span class="co">#&gt; fitting model and testing</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_dds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">dds</span><span class="op">)</span><span class="op">[</span>, <span class="st">"WaldPvalue_P1"</span><span class="op">]</span></span>
<span><span class="va">qval_dds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qvalue/man/qvalue.html" class="external-link">qvalue</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">pval_dds</span><span class="op">)</span></span></code></pre></div>
<p>We plot the coefficient estimates against their true values.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coefmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">dds</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"true_P1"</span>, <span class="st">"P1"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coefmat</span><span class="op">$</span><span class="va">true_P1</span>, </span>
<span>     <span class="va">coefmat</span><span class="op">$</span><span class="va">P1</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"True Coefficients"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="st">"Estimated Coefficients"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate_rnaseq_files/figure-html/unnamed-chunk-36-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We also plot the q-values against the null status of each gene.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">qval_dds</span><span class="op">$</span><span class="va">qvalues</span> <span class="op">~</span> <span class="va">is_null_gene</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Null Gene"</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"q-value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate_rnaseq_files/figure-html/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The MSE is worse for DESeq2.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mse_limma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">bhat</span> <span class="op">-</span> <span class="va">thout</span><span class="op">$</span><span class="va">coefmat</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mse_deseq2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">coefmat</span><span class="op">$</span><span class="va">true_P1</span> <span class="op">-</span> <span class="va">coefmat</span><span class="op">$</span><span class="va">P1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mse_deseq2</span></span>
<span><span class="co">#&gt; [1] 1.095208</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mse_limma</span></span>
<span><span class="co">#&gt; [1] 0.2910528</span></span></code></pre></div>
<p>The FDP is about the same for the two pipelines. Both are OK, but
conservative.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">is_null_gene</span><span class="op">[</span><span class="va">qval_dds</span><span class="op">$</span><span class="va">qvalues</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.05263158</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">is_null_gene</span><span class="op">[</span><span class="va">qout</span><span class="op">$</span><span class="va">qvalues</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.01336898</span></span></code></pre></div>
<p>DESeq2 has more discoveries</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">qval_dds</span><span class="op">$</span><span class="va">qvalues</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 513</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">qout</span><span class="op">$</span><span class="va">qvalues</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 374</span></span></code></pre></div>
<p>As a side-note, it seems that the second surrogate variable is
getting at the dexamethasone variable.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">svout</span><span class="op">$</span><span class="va">sv</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="va">true_sv</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span>, </span>
<span>        xlab <span class="op">=</span> <span class="st">"Dexamethasone Treatment"</span>, </span>
<span>        ylab <span class="op">=</span> <span class="st">"2nd Surrogate Variable"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">true_sv</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">svout</span><span class="op">$</span><span class="va">sv</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate_rnaseq_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Gerard, D (2020). “Data-based RNA-seq simulations by binomial
thinning.” <em>BMC Bioinformatics</em>. 21(1), 206. doi: <a href="https://doi.org/10.1186/s12859-020-3450-9" class="external-link">10.1186/s12859-020-3450-9</a>.</li>
<li>Himes, Blanca E., Xiaofeng Jiang, Peter Wagner, Ruoxi Hu, Qiyu Wang,
Barbara Klanderman, Reid M. Whitaker et al. “RNA-Seq transcriptome
profiling identifies CRISPLD2 as a glucocorticoid responsive gene that
modulates cytokine function in airway smooth muscle cells.” <em>PloS
one</em> 9, no. 6 (2014): e99625.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Gerard.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
