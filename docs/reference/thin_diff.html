<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Binomial thinning for differential expression analysis. — thin_diff • seqgendiff</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Binomial thinning for differential expression analysis. — thin_diff"><meta property="og:description" content="Given a matrix of real RNA-seq counts, this function will add a known
amount of signal to the count matrix. This signal is given in the form
of a Poisson / negative binomial / mixture of negative binomials
generalized linear model with a log (base 2) link. The user may
specify any arbitrary design matrix and coefficient matrix. The user
may also control for the amount of correlation between the observed
covariates and any unobserved surrogate variables. The method is
described in detail in Gerard (2020)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">seqgendiff</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/different_thinners.html">Applying Different Thinning Functions</a>
    </li>
    <li>
      <a href="../articles/simulate_rnaseq.html">Simulate RNA-seq Data from Real Data</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dcgerard/seqgendiff/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Binomial thinning for differential expression analysis.</h1>
    <small class="dont-index">Source: <a href="https://github.com/dcgerard/seqgendiff/blob/HEAD/R/genthin.R" class="external-link"><code>R/genthin.R</code></a></small>
    <div class="hidden name"><code>thin_diff.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a matrix of real RNA-seq counts, this function will add a known
amount of signal to the count matrix. This signal is given in the form
of a Poisson / negative binomial / mixture of negative binomials
generalized linear model with a log (base 2) link. The user may
specify any arbitrary design matrix and coefficient matrix. The user
may also control for the amount of correlation between the observed
covariates and any unobserved surrogate variables. The method is
described in detail in Gerard (2020).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">thin_diff</span><span class="op">(</span></span>
<span>  <span class="va">mat</span>,</span>
<span>  design_fixed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coef_fixed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  design_perm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coef_perm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  target_cor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_sva <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  design_obs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  relative <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  change_colnames <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  permute_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hungarian"</span>, <span class="st">"marriage"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"thin"</span>, <span class="st">"mult"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>mat</dt>
<dd><p>A numeric matrix of RNA-seq counts. The rows index the genes and
the columns index the samples.</p></dd>


<dt>design_fixed</dt>
<dd><p>A numeric design matrix whose rows are fixed and not
to be permuted. The rows index the samples and the columns index the
variables. The intercept should <em>not</em> be included
(though see Section "Unestimable Components").</p></dd>


<dt>coef_fixed</dt>
<dd><p>A numeric matrix. The coefficients corresponding to
<code>design_fixed</code>. The rows index the genes and the columns index
the variables.</p></dd>


<dt>design_perm</dt>
<dd><p>A numeric design matrix whose rows are to be permuted
(thus controlling the amount by which they are correlated with the
surrogate variables). The rows index the samples and the columns index
the variables. The intercept should <em>not</em> be included
(though see Section "Unestimable Components").</p></dd>


<dt>coef_perm</dt>
<dd><p>A numeric matrix. The coefficients corresponding to
<code>design_perm</code>. The rows index the genes and the columns index
the variables.</p></dd>


<dt>target_cor</dt>
<dd><p>A numeric matrix of target correlations between the
variables in <code>design_perm</code> and the surrogate variables. The
rows index the observed covariates and the columns index the surrogate
variables. That is, <code>target_cor[i, j]</code> specifies the target
correlation between the <code>i</code>th column of <code>design_perm</code> and the
<code>j</code>th surrogate variable. The surrogate variables are estimated
either using factor analysis or surrogate variable analysis (see the
parameter <code>use_sva</code>).
The number of columns in <code>target_cor</code> specifies the number of
surrogate variables. Set <code>target_cor</code> to <code>NULL</code> to indicate
that <code>design_perm</code> and the surrogate variables are independent.</p></dd>


<dt>use_sva</dt>
<dd><p>A logical. Should we use surrogate variable analysis
(Leek and Storey, 2008) using <code>design_obs</code>
to estimate the hidden covariates (<code>TRUE</code>)
or should we just do an SVD on <code>log2(mat + 0.5)</code> after
regressing out <code>design_obs</code> (<code>FALSE</code>)? Setting this to
<code>TRUE</code> allows the surrogate variables to be correlated with the
observed covariates, while setting this to <code>FALSE</code> assumes that
the surrogate variables are orthogonal to the observed covariates. This
option only matters if <code>design_obs</code> is not <code>NULL</code>.
Defaults to <code>FALSE</code>.</p></dd>


<dt>design_obs</dt>
<dd><p>A numeric matrix of observed covariates that are NOT to
be a part of the signal generating process. Only used in estimating the
surrogate variables (if <code>target_cor</code> is not <code>NULL</code>).
The intercept should <em>not</em> be included (it will sometimes
produce an error if it is included).</p></dd>


<dt>relative</dt>
<dd><p>A logical. Should we apply relative thinning (<code>TRUE</code>)
or absolute thinning (<code>FALSE</code>). Only experts should change
the default.</p></dd>


<dt>change_colnames</dt>
<dd><p>A logical. Should we change the column-names
of the design matrices (<code>TRUE</code>) or not (<code>FALSE</code>)?
Each new column name begins with either "O" (observed), "P" (permuted),
or "F" (fixed), followed by a number. The letters correspond to
whether the variables come from <code>design_obs</code>, <code>design_perm</code>,
or <code>design_fixed</code>. Setting this to <code>TRUE</code>
also changes the column-names of the corresponding coefficient matrices.
Defaults to <code>TRUE</code>.</p></dd>


<dt>permute_method</dt>
<dd><p>Should we use the Gale-Shapley algorithm
for stable marriages (<code>"marriage"</code>) (Gale and Shapley, 1962)
as implemented in the matchingR package, or the Hungarian algorithm
(Papadimitriou and Steiglitz, 1982) (<code>"hungarian"</code>)
as implemented in the clue package (Hornik, 2005)? The
Hungarian method almost always works better, so is the default.</p></dd>


<dt>type</dt>
<dd><p>Should we apply binomial thinning (<code>type = "thin"</code>) or
just naive multiplication of the counts (<code>type = "mult"</code>).
You should always have this set to <code>"thin"</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list-like S3 object of class <code>ThinData</code>.
Components include some or all of the following:</p><dl><dt><code>mat</code></dt>
<dd><p>The modified matrix of counts.</p></dd>

  <dt><code>designmat</code></dt>
<dd><p>The design matrix of variables used to simulate
      signal. This is made by column-binding <code>design_fixed</code> and the
      permuted version of <code>design_perm</code>.</p></dd>

  <dt><code>coefmat</code></dt>
<dd><p>A matrix of coefficients corresponding to
      <code>designmat</code>.</p></dd>

  <dt><code>design_obs</code></dt>
<dd><p>Additional variables that should be included in
      your design matrix in downstream fittings. This is made by
      column-binding the vector of 1's with <code>design_obs</code>.</p></dd>

  <dt><code>sv</code></dt>
<dd><p>A matrix of estimated surrogate variables. In simulation
      studies you would probably leave this out and estimate your own
      surrogate variables.</p></dd>

  <dt><code>cormat</code></dt>
<dd><p>A matrix of target correlations between the
      surrogate variables and the permuted variables in the design matrix.
      This might be different from the <code>target_cor</code> you input because
      we pass it through <code><a href="fix_cor.html">fix_cor</a></code> to ensure
      positive semi-definiteness of the resulting covariance matrix.</p></dd>

  <dt><code>matching_var</code></dt>
<dd><p>A matrix of simulated variables used to
      permute <code>design_perm</code> if the <code>target_cor</code> is not
      <code>NULL</code>.</p></dd>


</dl></div>
    <div id="mathematical-formulation">
    <h2>Mathematical Formulation</h2>
    

<p>Let</p><dl><dt>\(N\)</dt>
<dd><p>Be the number of samples.</p></dd>

  <dt>\(G\)</dt>
<dd><p>Be the number of genes.</p></dd>

  <dt>\(Y\)</dt>
<dd><p>Be an \(G\) by \(N\) matrix of real RNA-seq counts.
      This is <code>mat</code>.</p></dd>

  <dt>\(X_1\)</dt>
<dd><p>Be an \(N\) by \(P_1\) user-provided design matrix.
      This is <code>design_fixed</code>.</p></dd>

  <dt>\(X_2\)</dt>
<dd><p>Be an \(N\) by \(P_2\) user-provided design matrix.
      This is <code>design_perm</code>.</p></dd>

  <dt>\(X_3\)</dt>
<dd><p>Be an \(N\) by \(P_3\) matrix of known covariates.
      This is <code>design_obs</code>.</p></dd>

  <dt>\(Z\)</dt>
<dd><p>Be an \(N\) by \(K\) matrix of unobserved surrogate
       variables. This is estimated when <code>target_cor</code> is not
       <code>NULL</code>.</p></dd>

  <dt>\(M\)</dt>
<dd><p>Be a \(G\) by \(N\) of additional (unknown)
       unwanted variation.</p></dd>


</dl><p>We assume that \(Y\) is Poisson distributed given \(X_3\) and
\(Z\) such that
$$\log_2(EY) = \mu 1_N' + B_3X_3' + AZ' + M.$$
<code>thin_diff()</code> will take as input \(X_1\), \(X_2\), \(B_1\),
\(B_2\), and will output a \(\tilde{Y}\) and \(W\) such that
\(\tilde{Y}\) is Poisson distributed given \(X_1\), \(X_2\), \(X_3\),
\(W\), \(Z\), and \(M\) such that
$$\log_2(E\tilde{Y}) \approx \tilde{\mu}1_N' + B_1X_1' + B_2X_2'W' + B_3X_3' + AZ' + M,$$
where \(W\) is an \(N\) by \(N\) permutation matrix. \(W\) is randomly
drawn so that \(WX_2\) and \(Z\) are correlated approximately according
to the target correlation matrix.</p>
<p>The Poisson assumption may be generalized to a mixture of negative binomials.</p>
    </div>
    <div id="unestimable-components">
    <h2>Unestimable Components</h2>
    


<p>It is possible to include an intercept term or a column from
<code>design_obs</code> into either <code>design_fixed</code> or <code>design_perm</code>.
This will not produce an error and the specified thinning will be applied.
However, If any column of <code>design_fixed</code> or
<code>design_perm</code> is a vector of ones or contains a column from
<code>design_obs</code>, then the corresponding columns in <code>coef_fixed</code>
or <code>coef_perm</code> cannot be estimated by <em>any</em> method. This is
represented in the output by having duplicate columns in
<code>designmat</code> and <code>design_obs</code>.</p>
<p>Including duplicate columns in <code>design_fixed</code> and <code>design_perm</code>
is also allowed but, again, will produce unestimable coefficients.</p>
<p>Including an intercept term in <code>design_obs</code> will produce an error if
you are specifying correlated surrogate variables.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    
<ul><li><p>Gale, David, and Lloyd S. Shapley. "College admissions and the stability of marriage." <em>The American Mathematical Monthly</em> 69, no. 1 (1962): 9-15. <a href="https://doi.org/10.1080/00029890.1962.11989827" class="external-link">doi:10.1080/00029890.1962.11989827</a>
.</p></li>
<li><p>Gerard, D (2020). "Data-based RNA-seq simulations by binomial thinning." <em>BMC Bioinformatics</em>. 21(1), 206. <a href="https://doi.org/10.1186/s12859-020-3450-9" class="external-link">doi:10.1186/s12859-020-3450-9</a>
.</p></li>
<li><p>Hornik K (2005). "A CLUE for CLUster Ensembles." <em>Journal of Statistical Software</em>, 14(12). <a href="https://doi.org/10.18637/jss.v014.i12" class="external-link">doi:10.18637/jss.v014.i12</a>
.</p></li>
<li><p>Leek, Jeffrey T., and John D. Storey. "A general framework for multiple testing dependence." <em>Proceedings of the National Academy of Sciences</em> 105, no. 48 (2008): 18718-18723. <a href="https://doi.org/10.1073/pnas.0808709105" class="external-link">doi:10.1073/pnas.0808709105</a>
.</p></li>
<li><p>C. Papadimitriou and K. Steiglitz (1982), Combinatorial Optimization: Algorithms and Complexity. Englewood Cliffs: Prentice Hall.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<dl><dt><code><a href="select_counts.html">select_counts</a></code></dt>
<dd><p>For subsampling the rows and columns
      of your real RNA-seq count matrix prior to applying binomial thinning.</p></dd>

  <dt><code><a href="thin_2group.html">thin_2group</a></code></dt>
<dd><p>For the specific application of
      <code>thin_diff</code> to the two-group model.</p></dd>

  <dt><code><a href="thin_lib.html">thin_lib</a></code></dt>
<dd><p>For the specific application of
      <code>thin_diff</code> to library size thinning.</p></dd>

  <dt><code><a href="thin_gene.html">thin_gene</a></code></dt>
<dd><p>For the specific application of
      <code>thin_diff</code> to total gene expression thinning.</p></dd>

  <dt><code><a href="thin_all.html">thin_all</a></code></dt>
<dd><p>For the specific application of
      <code>thin_diff</code> to thinning all counts uniformly.</p></dd>

  <dt><code><a href="thin_base.html">thin_base</a></code></dt>
<dd><p>For the underlying thinning function
      used in <code>thin_diff</code>.</p></dd>

  <dt><code><a href="https://rdrr.io/pkg/sva/man/sva.html" class="external-link">sva</a></code></dt>
<dd><p>For the implementation of surrogate
      variable analysis.</p></dd>

  <dt><code><a href="ThinDataToSummarizedExperiment.html">ThinDataToSummarizedExperiment</a></code></dt>
<dd><p>For converting a
      ThinData object to a SummarizedExperiment object.</p></dd>

  <dt><code><a href="ThinDataToDESeqDataSet.html">ThinDataToDESeqDataSet</a></code></dt>
<dd><p>For converting a
      ThinData object to a DESeqDataSet object.</p></dd>


</dl></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>David Gerard</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Generate simulated data with surrogate variables</span></span></span>
<span class="r-in"><span><span class="co">## In practice, you would obtain mat from a real dataset, not simulate it.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="va">alpha</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                            nrow <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>                                            ncol <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Choose simulation parameters</span></span></span>
<span class="r-in"><span><span class="va">design_perm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coef_perm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">design_perm</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Specify one surrogate variable (number of columns in taget_cor),</span></span></span>
<span class="r-in"><span><span class="co">## highly correlated with first observed covariate and uncorrelated</span></span></span>
<span class="r-in"><span><span class="co">## with second observed covariate</span></span></span>
<span class="r-in"><span><span class="va">target_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Thin</span></span></span>
<span class="r-in"><span><span class="va">thout</span> <span class="op">&lt;-</span> <span class="fu">thin_diff</span><span class="op">(</span>mat <span class="op">=</span> <span class="va">mat</span>,</span></span>
<span class="r-in"><span>                   design_perm <span class="op">=</span> <span class="va">design_perm</span>,</span></span>
<span class="r-in"><span>                   coef_perm <span class="op">=</span> <span class="va">coef_perm</span>,</span></span>
<span class="r-in"><span>                   target_cor <span class="op">=</span> <span class="va">target_cor</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## target_cor approximates correlation between estimated surrogate variable</span></span></span>
<span class="r-in"><span><span class="co">## and matching variable.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">matching_var</span>, <span class="va">thout</span><span class="op">$</span><span class="va">sv</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.92652364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.08621485</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Estimated surrogate variable is associated with true surrogate variable</span></span></span>
<span class="r-in"><span><span class="co">## (because the signal is strong in this case)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">thout</span><span class="op">$</span><span class="va">sv</span>, xlab <span class="op">=</span> <span class="st">"True SV"</span>, ylab <span class="op">=</span> <span class="st">"Estimated SV"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="thin_diff-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## So target_cor approximates correlation between surrogate variable and</span></span></span>
<span class="r-in"><span><span class="co">## matching variables</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">matching_var</span>, <span class="va">Z</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.91827513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.08834679</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Correlation between permuted covariates and surrogate variables are less</span></span></span>
<span class="r-in"><span><span class="co">## close to target_cor</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">designmat</span>, <span class="va">Z</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> P1  0.5890975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> P2 -0.2183653</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Estimated signal is correlated to true single. First variable is slightly</span></span></span>
<span class="r-in"><span><span class="co">## biased because the surrogate variable is not included.</span></span></span>
<span class="r-in"><span><span class="va">Ynew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">mat</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">thout</span><span class="op">$</span><span class="va">designmat</span></span></span>
<span class="r-in"><span><span class="va">coef_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Ynew</span> <span class="op">~</span> <span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">coefmat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">coef_est</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"First Variable"</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Coefficient"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Estimated Coefficient"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="thin_diff-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">coefmat</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">coef_est</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"Second Variable"</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Coefficient"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Estimated Coefficient"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="thin_diff-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## But estimated coefficient of the first variable is slightly closer when</span></span></span>
<span class="r-in"><span><span class="co">## the surrogate variable is included.</span></span></span>
<span class="r-in"><span><span class="va">Ynew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">mat</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">designmat</span>, <span class="va">thout</span><span class="op">$</span><span class="va">sv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coef_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Ynew</span> <span class="op">~</span> <span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">coefmat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">coef_est</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"First Variable"</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Coefficient"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Estimated Coefficient"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="thin_diff-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thout</span><span class="op">$</span><span class="va">coefmat</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">coef_est</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"Second Variable"</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Coefficient"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Estimated Coefficient"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="thin_diff-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by David Gerard.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

